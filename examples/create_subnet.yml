- name: Auto Generated Playbook
  hosts: localhost
  gather_facts: false
  collections:
    - nutanix.ncp
  tasks:
    - name: Setting Variables
      set_fact:
        IP: ''
        username: ''
        password: ''
        ClusterName: auto_cluster_prod_1aa888141361
        ClusterUUID: 0005d578-2faf-9fb6-3c07-ac1f6b6f9780
        Virtual_Switch_Name: vs0
        Virtual_Switch_UUID: ''
        Network_IP: null
        Network_Prefix: null
        Gateway_IP: null
        Start_IP: null
        End_IP: null
        DNS_Servers: []
        Domain_Search: []
        Domain_Name: []
        TFTP_Server_Name: ''
        Boot_File: ''
        DHCP_Server_IP: null
    - name: 'VLAN subnet with IPAM, IP pools and DHCP'
      ntnx_subnets:
        state: present
        nutanix_host: '{{ IP }}'
        validate_certs: false
        nutanix_username: '{{ username }}'
        nutanix_password: '{{ password }}'
        name: VLAN subnet with IPAM IP pools and DHCP
        vlan_subnet:
          vlan_id: 29
          virtual_switch:
            name: '{{ Virtual_Switch_Name }}'
          cluster:
            name: '{{ ClusterName }}'
          ipam:
            network_ip: '{{ Network_IP }}'
            network_prefix: '{{ Network_Prefix }}'
            gateway_ip: '{{ Gateway_IP }}'
            ip_pools:
              - start_ip: '{{ Start_IP }}'
                end_ip: '{{ End_IP }}'
            dhcp:
              dns_servers: '{{ DNS_Servers }}'
              domain_search: '{{ Domain_Search }}'
              domain_name: '{{ Domain_Name }}'
              tftp_server_name: '{{ TFTP_Server_Name }}'
              boot_file: '{{ Boot_File }}'
              dhcp_server_ip: '{{ DHCP_Server_IP }}'
      register: result
      ignore_errors: true
    - name: External subnet with NAT
      ntnx_subnets:
        state: present
        nutanix_host: '{{ IP }}'
        validate_certs: false
        nutanix_username: '{{ username }}'
        nutanix_password: '{{ password }}'
        name: ' External subnet with NAT '
        external_subnet:
          vlan_id: 30
          enable_nat: true
          cluster:
            name: '{{ ClusterName }}'
          ipam:
            network_ip: '{{ Network_IP }}'
            network_prefix: '{{ Network_Prefix }}'
            gateway_ip: '{{ Gateway_IP }}'
            ip_pools:
              - start_ip: '{{ Start_IP }}'
                end_ip: '{{ End_IP }}'
      register: result
      ignore_errors: true
    - name: Overlay Subnet with IP_pools and DHCP
      ntnx_subnets:
        state: present
        nutanix_host: '{{ IP }}'
        validate_certs: false
        nutanix_username: '{{ username }}'
        nutanix_password: '{{ password }}'
        name: Overlay Subnet with IP_pools and DHCP
        overlay_subnet:
          vpc:
            name: '{{ VPC_Name }}'
          ipam:
            network_ip: '{{ Network_IP }}'
            network_prefix: '{{ Network_Prefix }}'
            gateway_ip: '{{ Gateway_IP }}'
            ip_pools:
              - start_ip: '{{ Start_IP }}'
                end_ip: '{{ End_IP }}'
            dhcp:
              dns_servers: '{{ DNS_Servers }}'
              domain_search: '{{ Domain_Search }}'
              domain_name: '{{ Domain_Name }}'
              tftp_server_name: '{{ TFTP_Server_Name }}'
              boot_file_name: '{{ Boot_File}}'
      register: result
      ignore_errors: true
