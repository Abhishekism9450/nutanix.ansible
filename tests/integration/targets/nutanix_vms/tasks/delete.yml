---
- name: VM with minimum requiremnts
  ntnx_vms:
      state: present
      name: MinReqVM
      nutanix_host: "{{ IP }}"
      nutanix_username: "{{ username }}"
      nutanix_password: "{{ password }}"
      validate_certs: False
      cluster:
        name: "{{ ClusterName }}"
  register: result
  ignore_errors: true
    
- name: Creation Status
  assert:
      that:
        - result.response is defined
        - result.response.status.state == 'COMPLETE'
      fail_msg: ' Unable to create VM with minimum requiremnts '
      success_msg: ' VM with minimum requiremnts created successfully '
      
- name: delete vm
  ntnx_vms:
    vm_uuid: '{{ result["response"]["metadata"]["uuid"] }}'
    state: absent
    nutanix_host: "{{ IP }}"
    nutanix_username: "{{ username }}"
    nutanix_password: "{{ password }}"
    validate_certs: False
  register: result


- name: assert when status not complete
  assert:
    that:
      - result.response is defined
      - result.response.status == 'SUCCEEDED'
    fail_msg: "Unable to delete Vm"
    success_msg: "VM   Deleted successfully"
