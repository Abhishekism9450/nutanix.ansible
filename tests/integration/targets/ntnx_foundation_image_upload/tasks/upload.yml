---
- debug:
    msg: start testing ntnx_foundation_image_upload

- name: Image upload with esx installer_type
  ntnx_foundation_image_upload:
    state: present
    source: "~/integration-test-ntnx-package.tar.gz"
    filename: "dont_use_nutanix_installer_package-integration-test.tar.gz"
    installer_type: esx
    timeout: 3600
  register: result
  ignore_errors: true

- name: Creation Status
  assert:
    that:
      - result.response is defined
      - result.failed==false
      - result.changed==true
    fail_msg: " Fail : unable upload image  with esx installer_type "
    success_msg: "Succes: upload image  with esx installer_type successfully "

- name: Delete Image with esx installer_type
  ntnx_foundation_image_upload:
    state: absent
    filename: "dont_use_nutanix_installer_package-integration-test.tar.gz"
    installer_type: esx
  register: result
  ignore_errors: true

- name: Creation Status
  assert:
    that:
      - result.response.status_code == 200
      - result.failed==false
      - result.changed==true
    fail_msg: " Fail : unable to delete image  with esx installer_type "
    success_msg: "Succes: image  with esx installer_type deleted successfully "
